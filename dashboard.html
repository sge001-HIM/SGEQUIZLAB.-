<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Dashboard â€” SGEQUIZLAB</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="dashboard.css"/>
</head>
<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <a href="index.html" class="sidebar-brand">SGE<span>QUIZ</span>LAB</a>

    <nav class="sidebar-nav">
      <div class="nav-section-label">Main</div>

      <button class="nav-item active" data-panel="overview">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
        </svg>
        Overview
      </button>

      <button class="nav-item" data-panel="myquizzes">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        My Quizzes
      </button>

      <button class="nav-item" data-panel="public">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="2" y1="12" x2="22" y2="12"/>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
        </svg>
        Public Quizzes
      </button>

      <div class="nav-section-label" style="margin-top:12px">Tools</div>

      <a href="admin.html" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/>
        </svg>
        Quiz Creator
      </a>

      <a href="index.html" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        Home
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-chip">
        <div class="user-avatar"></div>
        <div class="user-info">
          <div class="user-name"></div>
          <div class="user-role">Admin</div>
        </div>
      </div>
      <button class="nav-item danger" id="btn-logout" style="margin-top:6px">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        Sign Out
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">

    <!-- TOPBAR -->
    <header class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <button class="mobile-toggle" id="mobile-toggle" aria-label="Toggle sidebar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <div>
          <div class="topbar-title" id="topbar-title">Overview</div>
        </div>
      </div>
      <div class="topbar-actions">
        <a href="admin.html" class="btn btn-primary btn-sm">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          New Quiz
        </a>
      </div>
    </header>

    <!-- CONTENT -->
    <div class="content">

      <!-- OVERVIEW PANEL -->
      <div class="panel active" id="panel-overview">
        <div style="margin-bottom:24px">
          <h1 style="font-size:20px;font-weight:700;margin-bottom:4px">Welcome back, <span id="welcome-name"></span></h1>
          <p style="font-size:13.5px;color:var(--text-muted)">Here is a summary of your quiz activity.</p>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Quizzes</div>
            <div class="stat-value primary" id="stat-total-quizzes">
              <div class="skeleton" style="width:48px;height:32px"></div>
            </div>
            <div class="stat-sub">Quizzes you have created</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Attempts</div>
            <div class="stat-value" id="stat-total-attempts">
              <div class="skeleton" style="width:48px;height:32px"></div>
            </div>
            <div class="stat-sub">Across all your quizzes</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Highest Score</div>
            <div class="stat-value success" id="stat-highest-score">
              <div class="skeleton" style="width:64px;height:32px"></div>
            </div>
            <div class="stat-sub">Best percentage achieved</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Average Score</div>
            <div class="stat-value warning" id="stat-average-score">
              <div class="skeleton" style="width:64px;height:32px"></div>
            </div>
            <div class="stat-sub">Mean across all attempts</div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <div class="section-title">Recent Quizzes</div>
            <button class="btn btn-ghost btn-sm" data-panel="myquizzes" onclick="document.querySelector('.nav-item[data-panel=myquizzes]').click()">View all</button>
          </div>
          <div class="quiz-grid" id="overview-recent-grid">
            <div class="loading-block"><div class="spinner spinner-lg"></div><span>Loading...</span></div>
          </div>
        </div>
      </div>

      <!-- MY QUIZZES PANEL -->
      <div class="panel" id="panel-myquizzes">
        <div class="section-header" style="margin-bottom:20px">
          <div>
            <div class="section-title" style="font-size:18px">My Quizzes</div>
            <div style="font-size:12.5px;color:var(--text-muted);margin-top:2px">Quizzes you have created</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <div class="search-bar">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-my" placeholder="Search quizzes..."/>
            </div>
            <span class="section-count" id="my-quizzes-count">0</span>
          </div>
        </div>
        <div class="quiz-grid" id="my-quizzes-grid">
          <div class="loading-block"><div class="spinner spinner-lg"></div><span>Loading...</span></div>
        </div>
      </div>

      <!-- PUBLIC QUIZZES PANEL -->
      <div class="panel" id="panel-public">
        <div class="section-header" style="margin-bottom:20px">
          <div>
            <div class="section-title" style="font-size:18px">Public Quizzes</div>
            <div style="font-size:12.5px;color:var(--text-muted);margin-top:2px">Available to all users</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <div class="search-bar">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-public" placeholder="Search public quizzes..."/>
            </div>
            <span class="section-count" id="public-quizzes-count">0</span>
          </div>
        </div>
        <div class="quiz-grid" id="public-quizzes-grid">
          <div class="loading-block"><div class="spinner spinner-lg"></div><span>Loading...</span></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal-overlay" id="delete-modal">
  <div class="modal">
    <div class="modal-title">Delete Quiz</div>
    <div class="modal-body" id="delete-modal-body">Are you sure you want to delete this quiz? This action cannot be undone.</div>
    <div class="modal-actions">
      <button class="btn btn-ghost" id="btn-cancel-delete">Cancel</button>
      <button class="btn btn-danger" id="btn-confirm-delete">Delete</button>
    </div>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container"></div>

<script type="module" src="dashboard.js"></script>

<!-- POPULATE OVERVIEW RECENT GRID AFTER DATA LOADS -->
<script type="module">
  // Wait for myQuizzes to populate then show recent 4 in overview
  let attempts = 0;
  const interval = setInterval(() => {
    attempts++;
    const grid = document.getElementById('my-quizzes-grid');
    const overviewGrid = document.getElementById('overview-recent-grid');
    if (!overviewGrid) { clearInterval(interval); return; }
    if (grid && grid.querySelector('.quiz-card')) {
      const cards = Array.from(grid.querySelectorAll('.quiz-card')).slice(0, 4);
      if (cards.length) {
        overviewGrid.innerHTML = '';
        cards.forEach(c => overviewGrid.appendChild(c.cloneNode(true)));
        clearInterval(interval);
      }
    }
    if (attempts > 40) clearInterval(interval);
  }, 300);
</script>

</body>
</html>
